{
  "info": {
    "_postman_id": "6ce6dbe4-2972-4927-b24f-44260f03ab55",
    "name": "Library Management API - Full Automated Suite",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "Automated API suite with positive, negative, authorization, and end-to-end workflow scenarios."
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{bearerToken}}",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000/api/v1"
    },
    {
      "key": "bearerToken",
      "value": ""
    },
    {
      "key": "bookId",
      "value": ""
    },
    {
      "key": "borrowingId",
      "value": ""
    },
    {
      "key": "workflowBookId",
      "value": ""
    },
    {
      "key": "workflowBorrowingId",
      "value": ""
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "if (!pm.environment.get('runId')) {",
          "  const runId = Date.now().toString() + '_' + Math.floor(Math.random() * 100000).toString();",
          "  pm.environment.set('runId', runId);",
          "  if (!pm.environment.get('librarianEmail')) pm.environment.set('librarianEmail', 'librarian.' + runId + '@example.com');",
          "  if (!pm.environment.get('memberEmail')) pm.environment.set('memberEmail', 'member.' + runId + '@example.com');",
          "}"
        ]
      }
    }
  ],
  "item": [
    {
      "name": "10 Auth",
      "item": [
        {
          "name": "Register librarian (201)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{librarianEmail}}\",\n  \"password\": \"{{librarianPassword}}\",\n  \"role\": \"librarian\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "auth": {
              "type": "noauth"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const runId = Date.now().toString() + '_' + Math.floor(Math.random() * 100000).toString();",
                  "pm.environment.set('runId', runId);",
                  "pm.environment.set('librarianEmail', 'librarian.' + runId + '@example.com');",
                  "pm.environment.set('memberEmail', 'member.' + runId + '@example.com');",
                  "pm.environment.set('librarianPassword', pm.environment.get('librarianPassword') || 'Password123!');",
                  "pm.environment.set('memberPassword', pm.environment.get('memberPassword') || 'Password123!');"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 201', function () { pm.response.to.have.status(201); });",
                  "const payload = pm.response.json();",
                  "pm.test('Contains token and librarian user', function () {",
                  "  pm.expect(payload.token).to.be.a('string').and.not.empty;",
                  "  pm.expect(payload.user.role).to.eql('librarian');",
                  "});",
                  "pm.environment.set('librarianToken', payload.token);",
                  "pm.environment.set('librarianUserId', String(payload.user.id));",
                  "pm.collectionVariables.set('bearerToken', payload.token);"
                ]
              }
            }
          ]
        },
        {
          "name": "Register member (201)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{memberEmail}}\",\n  \"password\": \"{{memberPassword}}\",\n  \"role\": \"member\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "auth": {
              "type": "noauth"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 201', function () { pm.response.to.have.status(201); });",
                  "const payload = pm.response.json();",
                  "pm.environment.set('memberToken', payload.token);",
                  "pm.environment.set('memberUserId', String(payload.user.id));"
                ]
              }
            }
          ]
        },
        {
          "name": "Register invalid payload (422)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"invalid-email\",\n  \"password\": \"123\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "auth": {
              "type": "noauth"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 422', function () { pm.response.to.have.status(422); });",
                  "const payload = pm.response.json();",
                  "pm.test('Has error or errors payload', function () {",
                  "  pm.expect(payload.error !== undefined || payload.errors !== undefined).to.equal(true);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Login librarian (200)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/auth/login",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{librarianEmail}}\",\n  \"password\": \"{{librarianPassword}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "auth": {
              "type": "noauth"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 200', function () { pm.response.to.have.status(200); });",
                  "const payload = pm.response.json();",
                  "pm.environment.set('librarianToken', payload.token);",
                  "pm.collectionVariables.set('bearerToken', payload.token);"
                ]
              }
            }
          ]
        },
        {
          "name": "Login member (200)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/auth/login",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{memberEmail}}\",\n  \"password\": \"{{memberPassword}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "auth": {
              "type": "noauth"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 200', function () { pm.response.to.have.status(200); });",
                  "const payload = pm.response.json();",
                  "pm.environment.set('memberToken', payload.token);"
                ]
              }
            }
          ]
        },
        {
          "name": "Login invalid credentials (401)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/auth/login",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{memberEmail}}\",\n  \"password\": \"wrong-password\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "auth": {
              "type": "noauth"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 401', function () { pm.response.to.have.status(401); });",
                  "const payload = pm.response.json();",
                  "pm.test('Has error or errors payload', function () {",
                  "  pm.expect(payload.error !== undefined || payload.errors !== undefined).to.equal(true);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Logout unauthorized (401)",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/auth/logout",
            "auth": {
              "type": "noauth"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 401', function () { pm.response.to.have.status(401); });",
                  "const payload = pm.response.json();",
                  "pm.test('Has error or errors payload', function () {",
                  "  pm.expect(payload.error !== undefined || payload.errors !== undefined).to.equal(true);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Logout librarian (204)",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/auth/logout"
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.collectionVariables.set('bearerToken', pm.environment.get('librarianToken') || '');"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 204', function () { pm.response.to.have.status(204); });"
                ]
              }
            }
          ]
        },
        {
          "name": "Login librarian again (200)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/auth/login",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{librarianEmail}}\",\n  \"password\": \"{{librarianPassword}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "auth": {
              "type": "noauth"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 200', function () { pm.response.to.have.status(200); });",
                  "const payload = pm.response.json();",
                  "pm.environment.set('librarianToken', payload.token);",
                  "pm.collectionVariables.set('bearerToken', payload.token);"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "20 Books",
      "item": [
        {
          "name": "List books as librarian (200)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/books"
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.collectionVariables.set('bearerToken', pm.environment.get('librarianToken') || '');"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 200', function () { pm.response.to.have.status(200); });",
                  "const payload = pm.response.json();",
                  "pm.test('Books data is array', function () { pm.expect(payload.data).to.be.an('array'); });"
                ]
              }
            }
          ]
        },
        {
          "name": "Create book as librarian (201)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/books",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Postman Automation Book {{runId}}\",\n  \"author\": \"Automation Bot\",\n  \"genre\": \"Testing\",\n  \"isbn\": \"{{runId}}-LIB-001\",\n  \"total_copies\": 3\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.collectionVariables.set('bearerToken', pm.environment.get('librarianToken') || '');"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 201', function () { pm.response.to.have.status(201); });",
                  "const payload = pm.response.json();",
                  "pm.collectionVariables.set('bookId', String(payload.data.id));"
                ]
              }
            }
          ]
        },
        {
          "name": "Create invalid book payload (422)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/books",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"\",\n  \"total_copies\": -1\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.collectionVariables.set('bearerToken', pm.environment.get('librarianToken') || '');"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 422', function () { pm.response.to.have.status(422); });",
                  "const payload = pm.response.json();",
                  "pm.test('Has error or errors payload', function () {",
                  "  pm.expect(payload.error !== undefined || payload.errors !== undefined).to.equal(true);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Create book as member forbidden (403)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/books",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Forbidden Book\",\n  \"author\": \"Member User\",\n  \"genre\": \"Unauthorized\",\n  \"isbn\": \"{{runId}}-FORBIDDEN-001\",\n  \"total_copies\": 1\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.collectionVariables.set('bearerToken', pm.environment.get('memberToken') || '');"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 403', function () { pm.response.to.have.status(403); });",
                  "const payload = pm.response.json();",
                  "pm.test('Has error or errors payload', function () {",
                  "  pm.expect(payload.error !== undefined || payload.errors !== undefined).to.equal(true);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Get existing book by id (200)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/books/{{bookId}}"
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.collectionVariables.set('bearerToken', pm.environment.get('librarianToken') || '');"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 200', function () { pm.response.to.have.status(200); });",
                  "const payload = pm.response.json();",
                  "pm.expect(String(payload.data.id)).to.eql(pm.collectionVariables.get('bookId'));"
                ]
              }
            }
          ]
        },
        {
          "name": "Get missing book (404)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/books/99999999"
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.collectionVariables.set('bearerToken', pm.environment.get('librarianToken') || '');"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 404', function () { pm.response.to.have.status(404); });",
                  "const payload = pm.response.json();",
                  "pm.test('Has error or errors payload', function () {",
                  "  pm.expect(payload.error !== undefined || payload.errors !== undefined).to.equal(true);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Update book as librarian (200)",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/books/{{bookId}}",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Postman Automation Book Updated {{runId}}\",\n  \"author\": \"Automation Bot\",\n  \"genre\": \"Testing\",\n  \"isbn\": \"{{runId}}-LIB-001\",\n  \"total_copies\": 4\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.collectionVariables.set('bearerToken', pm.environment.get('librarianToken') || '');"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 200', function () { pm.response.to.have.status(200); });"
                ]
              }
            }
          ]
        },
        {
          "name": "Update book as member forbidden (403)",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/books/{{bookId}}",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Member Update Attempt\",\n  \"author\": \"Automation Bot\",\n  \"genre\": \"Testing\",\n  \"isbn\": \"{{runId}}-LIB-001\",\n  \"total_copies\": 1\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.collectionVariables.set('bearerToken', pm.environment.get('memberToken') || '');"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 403', function () { pm.response.to.have.status(403); });",
                  "const payload = pm.response.json();",
                  "pm.test('Has error or errors payload', function () {",
                  "  pm.expect(payload.error !== undefined || payload.errors !== undefined).to.equal(true);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "30 Borrowings",
      "item": [
        {
          "name": "List borrowings as member (200)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/borrowings"
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.collectionVariables.set('bearerToken', pm.environment.get('memberToken') || '');"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 200', function () { pm.response.to.have.status(200); });"
                ]
              }
            }
          ]
        },
        {
          "name": "Borrow book as member (201)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/borrowings/borrow",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"book_id\": \"{{bookId}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.collectionVariables.set('bearerToken', pm.environment.get('memberToken') || '');"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 201', function () { pm.response.to.have.status(201); });",
                  "const payload = pm.response.json();",
                  "pm.collectionVariables.set('borrowingId', String(payload.data.id));"
                ]
              }
            }
          ]
        },
        {
          "name": "Borrow same book twice (409)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/borrowings/borrow",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"book_id\": \"{{bookId}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.collectionVariables.set('bearerToken', pm.environment.get('memberToken') || '');"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 409', function () { pm.response.to.have.status(409); });",
                  "const payload = pm.response.json();",
                  "pm.test('Has error or errors payload', function () {",
                  "  pm.expect(payload.error !== undefined || payload.errors !== undefined).to.equal(true);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Borrow book as librarian forbidden (403)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/borrowings/borrow",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"book_id\": \"{{bookId}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.collectionVariables.set('bearerToken', pm.environment.get('librarianToken') || '');"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 403', function () { pm.response.to.have.status(403); });",
                  "const payload = pm.response.json();",
                  "pm.test('Has error or errors payload', function () {",
                  "  pm.expect(payload.error !== undefined || payload.errors !== undefined).to.equal(true);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Return borrowing as member forbidden (403)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/borrowings/{{borrowingId}}/return"
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.collectionVariables.set('bearerToken', pm.environment.get('memberToken') || '');"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 403', function () { pm.response.to.have.status(403); });",
                  "const payload = pm.response.json();",
                  "pm.test('Has error or errors payload', function () {",
                  "  pm.expect(payload.error !== undefined || payload.errors !== undefined).to.equal(true);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Return borrowing as librarian (200)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/borrowings/{{borrowingId}}/return"
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.collectionVariables.set('bearerToken', pm.environment.get('librarianToken') || '');"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 200', function () { pm.response.to.have.status(200); });"
                ]
              }
            }
          ]
        },
        {
          "name": "Return missing borrowing (404)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/borrowings/99999999/return"
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.collectionVariables.set('bearerToken', pm.environment.get('librarianToken') || '');"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 404', function () { pm.response.to.have.status(404); });",
                  "const payload = pm.response.json();",
                  "pm.test('Has error or errors payload', function () {",
                  "  pm.expect(payload.error !== undefined || payload.errors !== undefined).to.equal(true);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "40 Dashboards",
      "item": [
        {
          "name": "Librarian dashboard as librarian (200)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/dashboard/librarian"
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.collectionVariables.set('bearerToken', pm.environment.get('librarianToken') || '');"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 200', function () { pm.response.to.have.status(200); });"
                ]
              }
            }
          ]
        },
        {
          "name": "Member dashboard as member (200)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/dashboard/member"
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.collectionVariables.set('bearerToken', pm.environment.get('memberToken') || '');"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 200', function () { pm.response.to.have.status(200); });"
                ]
              }
            }
          ]
        },
        {
          "name": "Librarian dashboard as member forbidden (403)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/dashboard/librarian"
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.collectionVariables.set('bearerToken', pm.environment.get('memberToken') || '');"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 403', function () { pm.response.to.have.status(403); });",
                  "const payload = pm.response.json();",
                  "pm.test('Has error or errors payload', function () {",
                  "  pm.expect(payload.error !== undefined || payload.errors !== undefined).to.equal(true);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Member dashboard as librarian forbidden (403)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/dashboard/member"
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.collectionVariables.set('bearerToken', pm.environment.get('librarianToken') || '');"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 403', function () { pm.response.to.have.status(403); });",
                  "const payload = pm.response.json();",
                  "pm.test('Has error or errors payload', function () {",
                  "  pm.expect(payload.error !== undefined || payload.errors !== undefined).to.equal(true);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "90 Workflows",
      "item": [
        {
          "name": "Workflow - Librarian Management",
          "item": [
            {
              "name": "WF1 Login librarian",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": "{{baseUrl}}/auth/login",
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"email\": \"{{librarianEmail}}\",\n  \"password\": \"{{librarianPassword}}\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "auth": {
                  "type": "noauth"
                }
              },
              "response": [],
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "type": "text/javascript",
                    "exec": [
                      "pm.response.to.have.status(200);",
                      "const payload = pm.response.json();",
                      "pm.environment.set('librarianToken', payload.token);",
                      "pm.collectionVariables.set('bearerToken', payload.token);"
                    ]
                  }
                }
              ]
            },
            {
              "name": "WF1 Create workflow book",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": "{{baseUrl}}/books",
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"title\": \"Workflow Book {{runId}}\",\n  \"author\": \"Workflow Librarian\",\n  \"genre\": \"Workflow\",\n  \"isbn\": \"{{runId}}-WF-001\",\n  \"total_copies\": 2\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                }
              },
              "response": [],
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "type": "text/javascript",
                    "exec": [
                      "pm.collectionVariables.set('bearerToken', pm.environment.get('librarianToken') || '');"
                    ]
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "type": "text/javascript",
                    "exec": [
                      "pm.response.to.have.status(201);",
                      "const payload = pm.response.json();",
                      "pm.collectionVariables.set('workflowBookId', String(payload.data.id));"
                    ]
                  }
                }
              ]
            },
            {
              "name": "WF1 Update workflow book",
              "request": {
                "method": "PATCH",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": "{{baseUrl}}/books/{{workflowBookId}}",
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"title\": \"Workflow Book Updated {{runId}}\",\n  \"author\": \"Workflow Librarian\",\n  \"genre\": \"Workflow\",\n  \"isbn\": \"{{runId}}-WF-001\",\n  \"total_copies\": 3\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                }
              },
              "response": [],
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "type": "text/javascript",
                    "exec": [
                      "pm.collectionVariables.set('bearerToken', pm.environment.get('librarianToken') || '');"
                    ]
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "type": "text/javascript",
                    "exec": [
                      "pm.response.to.have.status(200);"
                    ]
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "Workflow - Member Borrow and Return",
          "item": [
            {
              "name": "WF2 Login member",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": "{{baseUrl}}/auth/login",
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"email\": \"{{memberEmail}}\",\n  \"password\": \"{{memberPassword}}\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "auth": {
                  "type": "noauth"
                }
              },
              "response": [],
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "type": "text/javascript",
                    "exec": [
                      "pm.response.to.have.status(200);",
                      "const payload = pm.response.json();",
                      "pm.environment.set('memberToken', payload.token);"
                    ]
                  }
                }
              ]
            },
            {
              "name": "WF2 Member borrows workflow book",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": "{{baseUrl}}/borrowings/borrow",
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"book_id\": \"{{workflowBookId}}\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                }
              },
              "response": [],
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "type": "text/javascript",
                    "exec": [
                      "pm.collectionVariables.set('bearerToken', pm.environment.get('memberToken') || '');"
                    ]
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "type": "text/javascript",
                    "exec": [
                      "pm.response.to.have.status(201);",
                      "const payload = pm.response.json();",
                      "pm.collectionVariables.set('workflowBorrowingId', String(payload.data.id));"
                    ]
                  }
                }
              ]
            },
            {
              "name": "WF2 Login librarian",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": "{{baseUrl}}/auth/login",
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"email\": \"{{librarianEmail}}\",\n  \"password\": \"{{librarianPassword}}\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "auth": {
                  "type": "noauth"
                }
              },
              "response": [],
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "type": "text/javascript",
                    "exec": [
                      "pm.response.to.have.status(200);",
                      "const payload = pm.response.json();",
                      "pm.environment.set('librarianToken', payload.token);"
                    ]
                  }
                }
              ]
            },
            {
              "name": "WF2 Librarian returns workflow borrowing",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  }
                ],
                "url": "{{baseUrl}}/borrowings/{{workflowBorrowingId}}/return"
              },
              "response": [],
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "type": "text/javascript",
                    "exec": [
                      "pm.collectionVariables.set('bearerToken', pm.environment.get('librarianToken') || '');"
                    ]
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "type": "text/javascript",
                    "exec": [
                      "pm.response.to.have.status(200);"
                    ]
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "Workflow - Authorization Matrix",
          "item": [
            {
              "name": "WF3 Member cannot create book (403)",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": "{{baseUrl}}/books",
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"title\": \"Auth Matrix Denied\",\n  \"author\": \"Member\",\n  \"genre\": \"Denied\",\n  \"isbn\": \"{{runId}}-DENIED-001\",\n  \"total_copies\": 1\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                }
              },
              "response": [],
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "type": "text/javascript",
                    "exec": [
                      "pm.collectionVariables.set('bearerToken', pm.environment.get('memberToken') || '');"
                    ]
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "type": "text/javascript",
                    "exec": [
                      "pm.response.to.have.status(403);"
                    ]
                  }
                }
              ]
            },
            {
              "name": "WF3 Librarian cannot borrow (403)",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": "{{baseUrl}}/borrowings/borrow",
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"book_id\": \"{{workflowBookId}}\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                }
              },
              "response": [],
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "type": "text/javascript",
                    "exec": [
                      "pm.collectionVariables.set('bearerToken', pm.environment.get('librarianToken') || '');"
                    ]
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "type": "text/javascript",
                    "exec": [
                      "pm.response.to.have.status(403);"
                    ]
                  }
                }
              ]
            },
            {
              "name": "WF3 No token cannot list books (401)",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  }
                ],
                "url": "{{baseUrl}}/books",
                "auth": {
                  "type": "noauth"
                }
              },
              "response": [],
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "type": "text/javascript",
                    "exec": [
                      "pm.response.to.have.status(401);"
                    ]
                  }
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
